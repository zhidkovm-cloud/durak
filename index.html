<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
<title>–î—É—Ä–∞–∫ ‚Äî v9.6.1 (portrait-first)</title>
<!-- Build v9.6.1 @ 2025-09-06T14:32:42.892477Z -->

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0f6b50">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

<style>
  :root{
    --vh: 1vh; /* updated via JS */
    --card-w: 72px;
    --card-h: calc(var(--card-w) * 1.4);
    --overlap: -0.64;
    --deckW: 118px;
    --uiScale: 1;
    --footerH: 64px;
    --fontSmall: 12px;
    --fontBig: 18px;
  }
  *{box-sizing:border-box}
  html, body { height: calc(var(--vh) * 100); overflow: hidden; }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
    background:linear-gradient(135deg,#dff5e6,#d7eef5);
  }
  #root{
    height: calc(var(--vh) * 100);
    max-width: 1100px;
    margin: 0 auto;
    display: grid;
    grid-template-rows: auto auto 1fr auto;
    gap: 4px;
    padding: 0 8px env(safe-area-inset-bottom) 8px;
  }
  header{
    display:flex;gap:8px;align-items:center;justify-content:space-between;
    padding-top: env(safe-area-inset-top);
  }
  .pill{padding:6px 10px;border-radius:999px;background:#fff;box-shadow:0 1px 2px #0002;border:1px solid #0001;font-size:14px; transform: scale(var(--uiScale))}
  button{
    min-height:38px; min-width:38px;
    padding:8px 12px;border-radius:14px;border:1px solid #0002;background:#fff;box-shadow:0 1px 3px #0002; cursor:pointer; font-weight:600;
    transform: scale(var(--uiScale));
  }
  button:active{transform: translateY(1px) scale(var(--uiScale))}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:nowrap}
  .muted{opacity:.72}
  .version{background:#0f6b50;color:#fff}

  .topline{display:flex; justify-content:space-between; align-items:center;}
  .opponent-row{display:flex; justify-content:space-between; align-items:center; gap:8px}
  .opponent-hand{display:flex; gap: calc(var(--card-w) * var(--overlap)); align-items:center; overflow:hidden}

  .middle{
    display:grid;
    grid-template-columns: 1fr minmax(84px, var(--deckW));
    gap:8px;
    align-items:stretch;
    height: calc(100% - var(--footerH));
  }
  .leftCol{ display:grid; grid-template-rows: 1fr auto; gap:6px; min-width: 0; }
  .table{ height: 100%; border-radius:18px; background:#fff8; box-shadow:inset 0 0 0 1px #0001; position:relative;
           padding:6px; display:flex; flex-wrap:wrap; gap:6px; align-content:flex-start; overflow:hidden; }
  .pair{position:relative; width:var(--card-w); height:calc(var(--card-h)+10px)}
  .slot{position:absolute; width:var(--card-w); height:var(--card-h); border:2px dashed #0003; border-radius:10px; top:0}
  .def{position:absolute; top:10px; left:12px; transform:rotate(-10deg)}
  .hand{display:flex; gap: calc(var(--card-w) * var(--overlap)); padding-bottom: 2px; overflow:hidden}

  .box{display:flex; flex-direction:column; gap:6px; align-items:stretch; padding:6px; border-radius:18px; background:#fff7; box-shadow:inset 0 0 0 1px #0001; height: fit-content}
  .stack{position:relative; width:calc(var(--card-w)+6px); height:calc(var(--card-h)+6px)}
  .stack .back{position:absolute; top:0; left:0; transform-origin:bottom right}
  .stack .back:nth-child(1){transform:translate(0px,0px) rotate(0deg)}
  .stack .back:nth-child(2){transform:translate(4px,2px) rotate(1deg)}
  .stack .back:nth-child(3){transform:translate(8px,4px) rotate(2deg)}
  .stack .back:nth-child(4){transform:translate(12px,6px) rotate(3deg)}
  .trump-half{ position:absolute; bottom:-8px; left:-22px; transform:rotate(90deg); transform-origin:bottom left; filter:drop-shadow(0 2px 6px rgba(0,0,0,.3)); z-index:0; pointer-events:none; transition:none !important; }
  .card{user-select:none; width:var(--card-w); height:var(--card-h); border-radius:12px; background:#fff; box-shadow:0 2px 8px #0003; border:1px solid #0002; padding:6px; display:flex; flex-direction:column; justify-content:space-between; transition: transform var(--animDur, .28s) ease, opacity var(--animDur, .28s) ease}
  .card.red{color:#c62828}
  .back{width:var(--card-w); height:var(--card-h); border-radius:12px; background:repeating-linear-gradient(45deg,#e3f2fd,#e3f2fd 6px,#bbdefb 6px,#bbdefb 12px); box-shadow:0 2px 8px #0003; border:1px solid #0002; z-index:1; position:relative}
  .small{font-size:var(--fontSmall);font-weight:700}
  .big{font-size:var(--fontBig);font-weight:800; text-align:center}
  .grow{flex:1}
  .appear{animation: pop var(--animDur, .25s) ease-out}
  @keyframes pop{ from{transform:scale(.96); opacity:.0} to{transform:scale(1); opacity:1} }
  .chat{display:flex; gap:6px; align-items:center}
  .emoji-btn{font-size:18px; background:#fff; border:1px solid #0002; border-radius:12px; padding:6px 8px; cursor:pointer; min-width:38px; min-height:38px; transform: scale(var(--uiScale))}
  .timer{padding:6px 10px;border-radius:12px; background:#fff; border:1px solid #0002; min-width:86px; text-align:center; transform: scale(var(--uiScale))}
  .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:calc(14px + env(safe-area-inset-bottom)); background:#1b5e20; color:#fff; padding:8px 12px; border-radius:999px; box-shadow:0 6px 24px #0005; display:none; z-index:99999}
  dialog{border:none; border-radius:16px; padding:16px; box-shadow:0 10px 40px #0003; max-width:92vw;width:clamp(280px,78vw,420px)}
  dialog::backdrop{background:rgba(0,0,0,.25)}
  .grid-cards{display:grid; grid-template-columns: repeat(auto-fill, minmax(var(--card-w), 1fr)); gap:10px; max-height:44vh; overflow:auto}

  footer.actionbar{
    height: var(--footerH);
    padding: 6px 6px calc(6px + env(safe-area-inset-bottom));
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    position:relative;
  }
  footer.actionbar .left, footer.actionbar .right{display:flex; gap:8px; align-items:center}
  footer.actionbar::before{
    content:""; position:absolute; left:-8px; right:-8px; top:-24px; height:24px;
    background: linear-gradient(to top, rgba(255,255,255,0.9), rgba(255,255,255,0));
    pointer-events:none;
  }

  @media (max-width: 360px){ .chat{display:none} }
</style>
</head>
<body>
<div id="root">
  <header>
    <div class="row">
      <div class="pill">–ö–æ–∑—ã—Ä—å: <span id="trumpSym">?</span></div>
      <div class="pill">–í –∫–æ–ª–æ–¥–µ: <span id="deckLeft">36</span></div>
      <div id="turnTimer" class="timer muted">‚Äî</div>
    </div>
    <div class="row">
      <div id="status" class="pill muted" style="max-width:52vw; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">‚Äî</div>
      <div class="pill version">v9.6.1</div>
      <button id="menuBtn" title="–ú–µ–Ω—é">‚ãØ</button>
    </div>
  </header>

  <div class="topline">
    <div class="opponent-row" style="flex:1">
      <div class="muted">–û–ø–ø–æ–Ω–µ–Ω—Ç: <span id="botCount">0</span> –∫–∞—Ä—Ç</div>
      <div class="opponent-hand" id="opponentHand"></div>
      <div class="row chat">
        <button class="emoji-btn" data-emo="üëç">üëç</button>
        <button class="emoji-btn" data-emo="üòÖ">üòÖ</button>
        <button class="emoji-btn" data-emo="üî•">üî•</button>
        <button class="emoji-btn" data-emo="üëè">üëè</button>
      </div>
    </div>
  </div>

  <main class="middle">
    <div class="leftCol">
      <div class="table" id="table"></div>
      <div class="hand" id="you"></div>
    </div>
    <div class="box" id="deckBox">
      <div class="pill">–ö–æ–ª–æ–¥–∞</div>
      <div class="stack" id="deckStack" style="margin-bottom:12px; position:relative"></div>
    </div>
  </main>

  <footer class="actionbar">
    <div class="left">
      <button id="takeBtn">–ë–µ—Ä—É</button>
      <button id="bitoBtn">–ë–∏—Ç–æ</button>
    </div>
    <div class="right">
      <button id="menuBtn2" title="–ú–µ–Ω—é">‚ãØ</button>
    </div>
  </footer>
</div>

<div id="toast" class="toast"></div>

<script>
// Register SW with version query to bypass stale caches
if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost')) {
  window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js?v=v9.6.1').catch(console.error));
}
function setVh(){ document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px'); }
setVh(); window.addEventListener('resize', ()=> setVh());

console.log('App version: v9.6.1');
</script>
</body>
</html>
